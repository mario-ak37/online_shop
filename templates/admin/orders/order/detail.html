{% extends "admin/base.html" %}
{% load static %}
{% block title %}
  Order {{ order.id }} {{ block.super }}
{% endblock title %}
{% block extrahead %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/order_detail.css' %}">
{% endblock extrahead %}
{% block content %}
  <div class="order-detail">
    <div class="breadcrumbs custom-breadcrumbs">
      <a href="{% url 'admin:index' %}">Home</a>
      <span>›</span>
      <a href="{% url 'admin:orders_order_changelist' %}">Orders</a>
      <span>›</span>
      <a href="{% url 'admin:orders_order_change' order.id %}">Order {{ order.id }}</a>
      <span>›</span>
      <span>Detail</span>
    </div>
    <div class="module order-card">
      <div class="order-header">
        <h1>Order {{ order.id }}</h1>
        <ul class="object-tools">
          <li>
            <a href="#" onclick="window.print();">Print order</a>
          </li>
        </ul>
      </div>
      <div class="order-row">
        <div class="order-label">Created</div>
        <div class="order-value">{{ order.created }}</div>
      </div>
      <div class="order-row">
        <div class="order-label">Customer</div>
        <div class="order-value">{{ order.first_name }} {{ order.last_name }}</div>
      </div>
      <div class="order-row">
        <div class="order-label">E-mail</div>
        <div class="order-value">
          <a href="mailto:{{ order.email }}">{{ order.email }}</a>
        </div>
      </div>
      <div class="order-row">
        <div class="order-label">Address</div>
        <div class="order-value">{{ order.address }}, {{ order.postal_code }} {{ order.city }}</div>
      </div>
      <div class="order-row">
        <div class="order-label">Total amount</div>
        <div class="order-value">${{ order.get_total_cost }}</div>
      </div>
      <div class="order-row">
        <div class="order-label">Status</div>
        <div class="order-value">
          {% if order.paid %}
            <span class="status status-paid">Paid</span>
          {% else %}
            <span class="status status-pending">Pending payment</span>
          {% endif %}
        </div>
      </div>
      <div class="order-row">
        <div class="order-label">Stripe payment</div>
        <div class="order-value">
          {% if order.stripe_id %}<a href="{{ order.get_stripe_url }}" target="_blank">{{ order.stripe_id }}</a>{% endif %}
        </div>
      </div>
    </div>
    <div class="module order-card">
      <h2>Items bought</h2>
      <table class="order-table">
        <thead>
          <tr>
            <th>Product</th>
            <th class="num">Price</th>
            <th class="num">Quantity</th>
            <th class="num">Total</th>
          </tr>
        </thead>
        <tbody>
          {% for item in order.items.all %}
            <tr>
              <td>{{ item.product.name }}</td>
              <td class="num">${{ item.price }}</td>
              <td class="num">{{ item.quantity }}</td>
              <td class="num">${{ item.get_cost }}</td>
            </tr>
          {% endfor %}
          {% if order.coupon %}
            <tr class="subtotal">
              <td colspan="3">Subtotal</td>
              <td class="num">${{ order.get_total_cost_before_discount|floatformat:2 }}</td>
            </tr>
            <tr class="coupon">
              <td colspan="3">
                "{{ order.coupon.code }}" coupon
                ({{ order.discount }}% off)
              </td>
              <td class="num neg">- ${{ order.get_discount|floatformat:2 }}</td>
            </tr>
          {% endif %}
          <tr class="total">
            <td colspan="3">Total</td>
            <td class="num">${{ order.get_total_cost|floatformat:2 }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
{% endblock content %}
